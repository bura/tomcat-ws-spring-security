<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

<meta charset="UTF-8" />
<title>Test</title>

<script type="text/javascript">
	var ws = null;

	function updateUI(connected) {
		document.getElementById('connect').disabled = connected;
		document.getElementById('disconnect').disabled = !connected;
		document.getElementById('send').disabled = !connected;
	}

	function connect() {
		var target = document.getElementById('target').value;
		if (target == '') {
			alert('Invalid target');
			return;
		}
		if ('WebSocket' in window) {
			ws = new WebSocket(target);
		} else if ('MozWebSocket' in window) {
			ws = new MozWebSocket(target);
		} else {
			alert('WebSocket is not supported by this browser');
			return;
		}
		ws.onopen = function() {
			updateUI(true);
			log('Info: WebSocket connection opened');
		};
		ws.onmessage = function(event) {
			log('Received: ' + event.data);
		};
		ws.onclose = function() {
			updateUI(false);
			log('Info: WebSocket connection closed');
		};
	}

	function disconnect() {
		if (ws != null) {
			ws.close();
			ws = null;
		}
		updateUI(false);
	}

	function send() {
		if (ws != null) {
			var message = document.getElementById('message').value;
			log('Sent: ' + message);
			ws.send(message);
		} else {
			alert('WebSocket connection not established, please connect');
		}
	}

	function updateTarget(target) {
		if (window.location.protocol == 'http:') {
			document.getElementById('target').value = 'ws://'
					+ window.location.host + target;
		} else {
			document.getElementById('target').value = 'wss://'
					+ window.location.host + target;
		}
	}

	function log(message) {
		var console = document.getElementById('console');
		var p = document.createElement('p');
		p.style.wordWrap = 'break-word';
		p.appendChild(document.createTextNode(message));
		console.appendChild(p);
		while (console.childNodes.length > 16) {
			console.removeChild(console.firstChild);
		}
		console.scrollTop = console.scrollHeight;
	}
</script>

</head>
<body>

	<div align="right">
		<a th:href="@{/j_spring_security_logout}">Logout</a>
	</div>

	<div>
		<input id="target" type="text" size="60" style="width: 400px" />
	</div>

	<script type="text/javascript">
		var targetStr;
		if (window.location.protocol == 'http:') {
			targetStr = 'ws://';
		} else {
			targetStr = 'wss://';
		}
		targetStr = targetStr + window.location.host + window.location.pathname
				+ 'ws';
		document.getElementById('target').value = targetStr;
	</script>

	<div>
		<button id="connect" onclick="connect();">Connect</button>
		<button id="disconnect" disabled="disabled" onclick="disconnect();">Disconnect</button>
	</div>

	<div>
		<textarea id="message" style="width: 350px"></textarea>
	</div>
	<div>
		<button id="send" onclick="send();" disabled="disabled">Send</button>
	</div>

	<div id="console" />

</body>
</html>